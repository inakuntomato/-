<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>チャージ計算</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: sans-serif;
      font-size: 20px;
      padding: 20px;
      background-color: #fdfdfd;
    }
    h2 {
      font-size: 26px;
      margin-bottom: 20px;
    }
    .time-group {
      margin-bottom: 20px;
    }
    .slider-label {
      margin-bottom: 6px;
      font-size: 18px;
    }
    input[type="range"] {
      width: 100%;
    }
    #timeDisplayStart, #timeDisplayEnd {
      font-size: 22px;
      margin-top: 5px;
    }
    select, button {
      font-size: 22px;
      padding: 10px;
      margin: 10px 0;
      box-sizing: border-box;
      width: 100%;
    }
    #nowBtn {
      font-size: 18px;
      padding: 6px 10px;
      width: auto;
      display: inline-block;
      margin-left: 10px;
      vertical-align: middle;
    }
    #calcBtn {
      font-size: 26px;
      padding: 14px;
      width: 100%;
      background-color: #444;
      color: white;
      border: none;
      cursor: pointer;
      margin-top: 20px;
    }
    #calcBtn:hover {
      background-color: #666;
    }
    #result {
      margin-top: 20px;
      font-weight: bold;
      font-size: 24px;
      color: #222;
    }
  </style>
</head>
<body>
  <h2>チャージ計算</h2>

  <div class="time-group">
    <div class="slider-label">開始時間:</div>
    <input type="range" id="startSlider" min="1080" max="1350" step="1" value="1080" oninput="updateTimeDisplay('start')">
    <div id="timeDisplayStart">18:00</div>
  </div>

  <div class="time-group">
    <div class="slider-label">
      終了時間:
      <button id="nowBtn" onclick="setNowToEnd()">今の時刻</button>
    </div>
    <input type="range" id="endSlider" min="1080" max="1350" step="1" value="1350" oninput="updateTimeDisplay('end')">
    <div id="timeDisplayEnd">22:30</div>
  </div>

  <label>性別を選択:
    <select id="gender">
      <option value="female">女性（500円/30分）</option>
      <option value="male">男性（1000円/30分）</option>
    </select>
  </label><br>

  <button id="calcBtn" onclick="calcUnits()">計算する</button>
  <p id="result"></p>

  <script>
    const MIN_TIME = 1080; // 18:00
    const MAX_TIME = 1350; // 22:30

    function minsToHHMM(mins) {
      const h = Math.floor(mins / 60);
      const m = mins % 60;
      return `${h}:${m.toString().padStart(2, '0')}`;
    }

    function updateTimeDisplay(type) {
      const val = document.getElementById(type + 'Slider').value;
      document.getElementById('timeDisplay' + capitalize(type)).innerText = minsToHHMM(val);
    }

    function capitalize(str) {
      return str.charAt(0).toUpperCase() + str.slice(1);
    }

    function setNowToEnd() {
      const now = new Date();
      const mins = now.getHours() * 60 + now.getMinutes();
      const clamped = Math.min(Math.max(mins, MIN_TIME), MAX_TIME); // 18:00未満なら18:00、22:30超なら22:30
      document.getElementById('endSlider').value = clamped;
      updateTimeDisplay('end');
    }

    function calcUnits() {
      const start = parseInt(document.getElementById('startSlider').value);
      const end = parseInt(document.getElementById('endSlider').value);
      const gender = document.getElementById('gender').value;

      if (end <= start) {
        document.getElementById('result').innerText = '終了時間は開始時間より後にせよ。';
        return;
      }

      const diff = end - start;
      const units = Math.floor(diff / 30);
      const hours = Math.floor(diff / 60);
      const minutes = diff % 60;
      const rate = gender === 'female' ? 500 : 1000;
      const total = units * rate;

      document.getElementById('result').innerText =
        `${hours}時間${minutes}分（${units}単位）です。\n料金: ${total}円`;
    }

    // 初期表示更新
    updateTimeDisplay('start');
    updateTimeDisplay('end');
  </script>
</body>
</html>
